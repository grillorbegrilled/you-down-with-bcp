<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Verse Fetch</title>
</head>
<body>
    <h1>Bible Verse Fetch</h1>
    <input type="text" id="bibleReference" placeholder="Enter Bible reference">
    <button onclick="handleBibleReference(document.getElementById('bibleReference').value)">Fetch</button>
    <div id="result"></div>

    <script>
        async function fetchBibleVerse(ref) {
            const resultDiv = document.getElementById('result');

            // Parse the reference
            const [bookChapter, verses] = ref.split(':');
            const [book, chapter] = bookChapter.split(' ');
            const bookLower = book.toLowerCase();
            let verseStart, verseEnd;

            if (verses) {
                if (verses.includes('-')) {
                    // Handle range of verses
                    [verseStart, verseEnd] = verses.split('-');
                } else if (verses.includes('ff')) {
                    // Handle "ff" (following verses)
                    verseStart = verses.replace('ff', '');
                    verseEnd = 'end'; // Placeholder for actual logic
                } else {
                    // Single verse or multiple verses separated by commas
                    verseStart = verses;
                }
            }

            try {
                // Fetch Bible chapter
                const response = await fetch(`https://cdn.jsdelivr.net/gh/wldeh/bible-api/bibles/en-US-kjvcpb/books/${bookLower}/chapters/${chapter}.json`);
                const data = await response.json();

                // Convert chapter and verse properties to numbers
                data.data.forEach(verse => {
                    verse.chapter = Number(verse.chapter);
                    verse.verse = Number(verse.verse);
                });

                // Filter and concatenate verses
                let versesText = '';
                data.data.forEach(verse => {
                    if (!verses || (verse.verse >= verseStart && (verseEnd === 'end' || verse.verse <= verseEnd))) {
                        versesText += verse.text + ' ';
                    }
                });

                // Display result
                return versesText.trim();
            } catch (error) {
                return 'Error fetching data: ' + error.message;
            }
        }

        async function handleBibleReference(bibleReference) {
            const resultDiv = document.getElementById('result');

            // Remove space if the second character is a space
            if (bibleReference[1] === ' ') {
                bibleReference = bibleReference[0] + bibleReference.slice(2);
            }

            if ((bibleReference.match(/:/g) || []).length <= 1) {
                // Zero or one colon
                const result = await fetchBibleVerse(bibleReference);
                resultDiv.innerHTML = result;
            } else {
                // Two colons
                const [firstPart, secondPart] = bibleReference.split('-');
                const [firstBookChapter, firstVerse] = firstPart.split(':');
                const [secondChapter, secondVerse] = secondPart.split(':');

                const firstRef = `${firstBookChapter}:${firstVerse}ff`;
                const secondRef = `${firstBookChapter.split(' ')[0]} ${secondChapter}:1-${secondVerse}`;

                const firstResult = await fetchBibleVerse(firstRef);
                const secondResult = await fetchBibleVerse(secondRef);

                resultDiv.innerHTML = `${firstResult} ${secondResult}`;
            }
        }
    </script>
</body>
</html>
