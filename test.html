<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Verse Fetch</title>
</head>
<body>
    <h1>Bible Verse Fetch</h1>
    <input type="text" id="bibleReference" placeholder="Enter Bible reference">
    <button onclick="handleBibleReference(document.getElementById('bibleReference').value)">Fetch</button>
    <div id="result"></div>

    <script>
        async function fetchBibleVerse(book, chapter, verses = "") {
            const resultDiv = document.getElementById('result');
            const bookLower = book.replace(/\s+/g, '').toLowerCase();
            let verseStart, verseEnd;

            if (verses) {
                if (verses.includes('-')) {
                    // Handle range of verses
                    [verseStart, verseEnd] = verses.split('-');
                } else if (verses.includes('ff')) {
                    // Handle "ff" (following verses)
                    verseStart = verses.replace('ff', '');
                    verseEnd = 'end'; // Placeholder for actual logic
                } else {
                    // Single verse or multiple verses separated by commas
                    verseStart = verses;
                }
            }

            try {
                // Fetch Bible chapter
                const response = await fetch(`https://cdn.jsdelivr.net/gh/wldeh/bible-api/bibles/en-US-kjvcpb/books/${bookLower}/chapters/${chapter}.json`);
                const data = await response.json();

                // Convert chapter and verse properties to numbers
                data.data.forEach(verse => {
                    verse.verse = Number(verse.verse);
                });

                // Filter and concatenate verses
                let versesText = '';
                data.data.forEach(verse => {
                    if (!verses || (verse.verse >= verseStart && (verseEnd === 'end' || verse.verse <= verseEnd))) {
                        versesText += verse.text + ' ';
                    }
                });

                // Display result
                return versesText.trim();
            } catch (error) {
                return 'Error fetching data: ' + error.message;
            }
        }

const splitAtLastSpace = str => str.split(/ (?!.* )/);

        async function handleBibleReference(bibleReference) {
            const resultDiv = document.getElementById('result');

            if (bibleReference.includes('&')) {
                // Handle ampersand
                const [firstPart, secondPart] = bibleReference.split('&').map(part => part.trim());
                const book = splitAtLastSpace(firstPart)[0];
                const firstResult = await fetchBibleVerse(book, splitAtLastSpace(firstPart)[1]);
                const secondResult = await fetchBibleVerse(book, secondPart);
                resultDiv.innerHTML = `${firstResult} ${secondResult}`;
            } else if ((bibleReference.match(/:/g) || []).length <= 1) {
                // Zero or one colon
                const [bookChapter, verses] = bibleReference.split(':');
                const [book, chapter] = splitAtLastSpace(bookChapter);
                const result = await fetchBibleVerse(book, chapter, verses);
                resultDiv.innerHTML = result;
            } else {
                // Two colons
                const [firstPart, secondPart] = bibleReference.split('-');
                const [firstBookChapter, firstVerse] = firstPart.split(':');
                const [secondChapter, secondVerse] = secondPart.split(':');

                const [book, firstChapter] = splitAtLastSpace(firstBookChapter);

                const firstResult = await fetchBibleVerse(book, firstChapter, `${firstVerse}ff`);
                const secondResult = await fetchBibleVerse(book, secondChapter, `1-${secondVerse}`);

                resultDiv.innerHTML = `${firstResult} ${secondResult}`;
            }
        }
    </script>
</body>
</html>
