<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>You Down With BCP?</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script> <!-- Include Turn.js -->
    <script src="ceg.js"></script>
    <script src="hymns.js"></script>
    <script src="dayNames.js"></script>
    <script src="canticles.js"></script>
    <script src="litany.js"></script>
    <script src="penitentialOffice.js"></script>
    <script src="timesAndSeasons.js"></script>
    <script src="colors.js"></script>
    <script src="marginalia.js"></script>
    <script src="scripts.js"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #flipbook {
            width: 100%;
            height: 100%;
            margin: 0;
        }

        .page {
            width: 100%;
            height: 100%;
            overflow: hidden;
            padding: 20px;
            box-sizing: border-box;
        }

        #content-container {
            visibility: hidden;  /* Hide the original content container */
        }
    </style>

    <script>
        window.onload = function() {
            // Grab all the content from the visible container
            const container = document.getElementById('content-container');

            // Set up the flipbook container
            const flipbook = document.createElement('div');
            flipbook.id = 'flipbook';
            document.body.appendChild(flipbook);

            // Function to paginate content dynamically, with forced page breaks at h1 elements
            function paginateContent(container) {
                const pageHeight = window.innerHeight; // Use full window height
                const pageWidth = window.innerWidth;  // Use full window width
                const pages = [];
                let currentPage = document.createElement('div');
                currentPage.classList.add('page');

                // Create a temporary container for measuring heights
                const tempPage = document.createElement('div');
                tempPage.style.width = pageWidth + 'px';
                tempPage.style.position = 'absolute';
                tempPage.style.visibility = 'hidden';
                document.body.appendChild(tempPage);

                let currentHeight = 0;

                // Iterate through all child nodes in the container
                Array.from(container.children).forEach(node => {
                    // Clone the node for appending and measuring
                    const clonedNode = node.cloneNode(true);

                    // Special case: If it's an h1, force a new page
                    if (node.tagName === 'H1') {
                        // Push the current page if it has content
                        if (currentPage.innerHTML.trim()) {
                            pages.push(currentPage);
                            currentPage = document.createElement('div');
                            currentPage.classList.add('page');
                        }
                        // Add the h1 element to the new page directly
                        currentPage.appendChild(clonedNode);
                        currentHeight = 0; // Reset height since it's a new page
                    } else {
                        // Measure how much space adding this node will take
                        tempPage.innerHTML = currentPage.innerHTML + clonedNode.outerHTML;
                        const newHeight = tempPage.offsetHeight;

                        if (newHeight > pageHeight) {
                            // If adding this node exceeds the page height, create a new page
                            pages.push(currentPage);
                            currentPage = document.createElement('div');
                            currentPage.classList.add('page');
                            currentPage.appendChild(clonedNode);
                            currentHeight = clonedNode.offsetHeight;
                        } else {
                            // Otherwise, add the node to the current page
                            currentPage.appendChild(clonedNode);
                            currentHeight = newHeight;
                        }
                    }
                });

                // Add the last page if it has content
                if (currentPage.innerHTML.trim()) {
                    pages.push(currentPage);
                }

                // Clean up the temporary container
                document.body.removeChild(tempPage);

                // Return the split pages
                return pages;
            }

            // Split the content into pages
            const pages = paginateContent(container);

            // Add each page to the flipbook
            pages.forEach(pageContent => {
                document.getElementById('flipbook').appendChild(pageContent);
            });

            // Initialize Turn.js for flipbook effect, using full window size
            $('#flipbook').turn({
                width: '100%',
                height: '100%',
                autoCenter: true
            });
        }
    </script>
</head>
<body>
    <div id="content-container">
        <img id="bookmark" class="bookmark">
        <p id="fastDayLabel" style="color: red;">Fast.</p>
        <div id="office">
            <h1 id="officeName">Morning Prayer</h1>
            <p>OUR Father, who art in heaven,...</p>
            <div id='canticle'></div>
        </div>
        <div id='creed'>
            <p>I BELIEVE in God the Father Almighty,...</p>
        </div>
        <p id='collect'></p>
        <div id='pfac'>
            <h2>A Prayer for All Conditions of Men</h2>
            <p>O GOD, the Creator and Preserver of all mankind,...</p>
        </div>
        <div id='genThanks'>
            <h2>A General Thanksgiving</h2>
            <p>ALMIGHTY God, Father of all mercies,...</p>
        </div>
        <p>THE grace of our Lord Jesus Christ,...</p>
    </div>
</body>
</html>
